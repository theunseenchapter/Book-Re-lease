<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Books</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="browse.css">
    <style>
        /* Add your CSS here or keep it in index.css */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: rgba(244, 244, 244, 0.95);
        }

        header {
            background-color: rgba(0, 51, 102, 0.95);
            color: white;
            padding: 1.5rem 0;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .search-bar {
            display: flex;
            justify-content: flex-start; /* Align items to the left */
            margin-bottom: 1.5rem; /* Space below the search bar */
        }

        .search-bar input {
            width: 250px; /* Fixed width for a cleaner look */
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px; /* Rounded corners on the left */
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .search-bar input:focus {
            border-color: rgba(0, 51, 102, 0.95);
            outline: none;
        }

        .search-bar button {
            padding: 0.75rem 1rem;
            border: 1px solid #ddd;
            border-radius: 0 4px 4px 0; /* Rounded corners on the right */
            background-color: rgba(0, 51, 102, 0.95);
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .search-bar button:hover {
            background-color: rgba(0, 51, 102, 1);
        }

        #books-dashboard {
            margin-top: 2rem;
        }

        .book-item {
            margin-bottom: 1rem;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.85);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
        }

        .book-item h3 {
            margin-bottom: 0.5rem;
            color: rgba(0, 51, 102, 0.95);
        }
    </style>
</head>
<body>
    <header>
        <h1>Book Re-Lease</h1>
        <nav>
            <ul class="nav-menu">
                <li><a href="browse.html">Browse Books</a></li>
                <li><a href="index.html#post">Post Your Book</a></li>
                <li><a href="index.html#profile">Profile</a></li>
                <li><a href="#" id="logout">Logout</a></li>
            </ul>
        </nav>
    </header>
    <div class="container">
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search for books..." />
            <button id="searchButton">Search</button>
        </div>
        <section id="books-dashboard">
            <h2>Books Available</h2>
            <div id="booksList"></div>
        </section>
    </div>

    <script>
        const apiUrl = 'http://localhost:3000';

        // Function to load books
        function loadBooks(query = '') {
            fetch(`${apiUrl}/search?query=${encodeURIComponent(query)}`, {
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                displayBooks(data);
            })
            .catch(error => {
                console.error('Error fetching books:', error);
                document.getElementById('booksList').innerHTML = '<p>Error fetching books. Please try again later.</p>';
            });
        }

        // Function to display books
        function displayBooks(books) {
            const booksDiv = document.getElementById('booksList');
            booksDiv.innerHTML = ''; // Clear previous books
            if (books.length === 0) {
                booksDiv.innerHTML = '<p>No books available.</p>';
            } else {
                books.forEach(book => {
                    const bookItem = document.createElement('div');
                    bookItem.className = 'book-item';
                    bookItem.innerHTML = `
                        <h3>${book.title}</h3>
                        <p>Author: ${book.author}</p>
                        <p>Type: ${book.type}</p>
                        <p>Price: $${book.price}</p>
                        ${book.book_image ? `<img src="${apiUrl}/uploads/${book.book_image}" alt="${book.title}" style="width:100px;height:150px;">` : ''}
                        <button class="book-btn" data-book-id="${book.id}">Book Your Book</button>
                    `;
                    booksDiv.appendChild(bookItem);
                });
            }
        }

        // Load books when the page loads
        window.onload = () => loadBooks();

        // Logout functionality
        document.getElementById('logout').addEventListener('click', function(e) {
            e.preventDefault();
            fetch(`${apiUrl}/logout`, {
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.href = 'login.html'; // Redirect to login page
                }
            })
            .catch(error => console.error('Error:', error));
        });

        // Event listener for search
        document.getElementById('searchButton').addEventListener('click', function() {
            const query = document.getElementById('searchInput').value.trim();
            loadBooks(query); // Load books with the search query
        });
    </script>
</body>
</html>
